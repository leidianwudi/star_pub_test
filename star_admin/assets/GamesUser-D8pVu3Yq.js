var b=(i,n,f)=>new Promise((V,y)=>{var w=d=>{try{h(f.next(d))}catch(m){y(m)}},L=d=>{try{h(f.throw(d))}catch(m){y(m)}},h=d=>d.done?V(d.value):Promise.resolve(d.value).then(w,L);h((f=f.apply(i,n)).next())});import{u as ne}from"./useTable-DohiMS5o.js";import{r as T,c as se,h as c,I as k}from"./index-Dg16wPeM.js";import{_ as ie}from"./Table.vue_vue_type_script_lang-B7JZHcWZ.js";/* empty css               *//* empty css                  */import{_ as re}from"./Search.vue_vue_type_script_setup_true_lang-VcwLHU14.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BSoUUQnL.js";import{_ as ue}from"./Write.vue_vue_type_script_setup_true_lang-B0GQJ8zv.js";import{_ as de}from"./Detail.vue_vue_type_script_setup_true_lang-nBbb_5Ye.js";import{_ as me}from"./ChangePassword.vue_vue_type_script_setup_true_lang-BcC1nVMe.js";import{_ as fe}from"./Dialog.vue_vue_type_style_index_0_lang-DhfduvPq.js";import{n as F,a3 as _,k as pe,b as E}from"./element-plus-B2PLgZHf.js";import{v as ge,r as u,u as o,V as H,M as a,H as S,x as z,y as ve,K as g,B as be,a3 as I,P,k as J,J as R,G as $}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Dby5emit.js";/* empty css                         *//* empty css                  */import"./index-y8XvmqNS.js";import"./Form-BSQhYHrI.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-DnUzEfZp.js";import"./style.css_vue_type_style_index_0_src_true_lang-zYImHsie.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-CETukC1m.js";import"./IconPicker-g7mhPobf.js";import"./IAgree.vue_vue_type_script_setup_true_lang-DsjjMfNO.js";import"./Highlight.vue_vue_type_script_lang-CytUL3R8.js";import"./useForm-D392SAX5.js";import"./useIcon-DpXlt4U3.js";import"./useValidator-Dq57AcmW.js";import"./Descriptions-CZirfgGQ.js";/* empty css                  */function ke(i,n){return T.post({url:"/user/select",data:{page:i,pageNum:n}})}function _e(i){return T.post({url:"/user/selectById",data:{id:i},headers:{"Cache-Control":"no-cache"}})}function K(i){return T.post({url:"/user/update",data:i})}const ye=i=>T.post({url:"/user/delete",data:{ids:i}}),we={class:"flex w-100% h-100%"},he={class:"mb-10px"},mt=ge({__name:"GamesUser",setup(i){const{t:n}=se(),f=u({}),{tableRegister:V,tableState:y,tableMethods:w}=ne({fetchDataApi:()=>b(this,null,function*(){const{currentPage:t,pageSize:e}=y;let l={};return C.value&&C.value.id?(l=yield _e(C.value.id),l.code===200&&(l.data.list=[l.data])):(l=yield ke(o(t),o(e)),l.data.list.forEach(r=>{r&&r.account&&(f.value[n(r.account)]=r.id)})),{list:l.data.list||[],total:l.data.total||0}}),fetchDelApi:()=>b(this,null,function*(){return!!(yield ye(o(A)))})}),{dataList:L,loading:h,total:d,currentPage:m,pageSize:B}=y,{getList:Q,getElTableExpose:W,delList:X}=w,Y=H([{field:"selection",type:"selection"},{field:"account",label:"账号"},{field:"token",label:"token"},{field:"name",label:"昵称"},{field:"lv",label:"等级"},{field:"visualId",label:"头像Id"},{field:"gender",label:"性别",slots:{default:t=>{let e="保密";return t.row.gender===1?e="男":t.row.gender===2&&(e="女"),a(S,null,[e])}}},{field:"introduction",label:"简介"},{field:"coin",label:"金币"},{field:"deleted",label:"是否删除",slots:{default:t=>a(F,{type:t.row.deleted?"success":"danger"},{default:()=>[a(S,null,[t.row.deleted?"是":"否"])]})}},{field:"failed_attempts",label:"密码失败次数"},{field:"last_attempt_time",label:"最后一次失败时间"},{field:"locked",label:"是否已经冻结",slots:{default:t=>a(F,{type:t.row.locked?"danger":"success"},{default:()=>[a(S,null,[t.row.locked?"冻结":"正常"])]})}},{field:"lock_until",label:"冻结持续到"},{field:"enable",label:"是否启用",slots:{default:t=>a(F,{type:t.row.enable?"success":"danger"},{default:()=>[a(S,null,[t.row.enable?"启用":"禁用"])]})}},{field:"diamond",label:"钻石数量"},{field:"total_bet",label:"消耗金币总量"},{field:"max_bet_one_time",label:"单次最大投注额"},{field:"action",label:n("userDemo.action"),width:340,slots:{default:t=>{const e=t.row;return a(S,null,[a(_,{content:"详情",placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>N(e,"detail")},{default:()=>[a(k,{icon:"vi-bx:detail"},null)]})]}),a(_,{content:"修改密码",placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>N(e,"change")},{default:()=>[a(k,{icon:"vi-material-symbols:passkey-rounded"},null)]})]}),a(_,{content:G(e.locked,"locked"),placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>q(e,"locked")},{default:()=>[a(k,{icon:"vi-game-icons:frozen-orb"},null)]})]}),a(_,{content:G(e.enable,"enabled"),placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>q(e,"enabled")},{default:()=>[a(k,{icon:"vi-material-symbols:person-add-disabled-outline-rounded"},null)]})]}),a(_,{content:"编辑",placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>N(e,"edit")},{default:()=>[a(k,{icon:"vi-mingcute:edit-line"},null)]})]}),a(_,{content:"删除",placement:"top"},{default:()=>[a(c,{size:"small",onClick:()=>j(e)},{default:()=>[a(k,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),Z=H([{field:"account",label:"账号",component:"Input"}]),G=(t,e)=>t===0?e==="locked"?"冻结":"启用":e==="locked"?"解冻":"禁用",C=u({}),O=t=>{if(t&&t.account){const e=t.account;C.value={id:f.value[e]}}else C.value=t;Q()},v=u(!1),p=u(""),x=u(),s=u(""),U=u(),D=u(!1),N=(t,e)=>{switch(e){case"edit":p.value="编辑";break;case"detail":p.value="用户详情";break;case"change":p.value="修改密码";break;case"locked":p.value="修改冻结状态";break;case"enabled":p.value="修改账户状态";break}s.value=e,x.value=t,v.value=!0},ee=()=>{p.value=n("exampleDemo.add"),x.value=void 0,v.value=!0,s.value="add"},A=u([]),M=u(!1),j=t=>b(this,null,function*(){const e=yield W();A.value=t?[t.id]:(e==null?void 0:e.getSelectionRows().map(l=>l.id))||[],M.value=!0,yield X(o(A).length).finally(()=>{M.value=!1})}),q=(t,e)=>{let l="是否冻结用户";t.locked===1&&(l="是否解冻用户"),e==="enabled"&&(t.enable===0?l="是否启用账户":l="是否禁用账户"),pe.confirm(l,"提示",{confirmButtonText:n("common.delOk"),cancelButtonText:n("common.delCancel"),type:"warning",center:!1}).then(()=>{const r=Object.assign({},t);e==="locked"?r.locked=r.locked===0?1:0:r.enable=r.enable===0?1:0,te(r)}).catch(()=>{E({type:"info",message:"取消修改状态"})})},te=t=>b(this,null,function*(){try{(yield K(t)).code===200&&(w.refresh(),E({type:"success",message:"修改成功"}))}catch(e){}}),ae=()=>b(this,null,function*(){const t=o(U),e=yield t==null?void 0:t.submit();e&&(D.value=!0,(yield K(e)).code===200?(w.getList(),D.value=!1,v.value=!1,E({type:"success",message:s.value==="add"?"添加成功":"修改成功"})):(D.value=!1,E({type:"error",message:"失败"})))}),le=t=>{m.value=t},oe=t=>{B.value=t};return(t,e)=>(z(),ve("div",we,[a(o(ce),{class:"flex-[3] ml-20px"},{default:g(()=>[a(o(re),{schema:Z,onReset:O,onSearch:O},null,8,["schema"]),be("div",he,[a(o(c),{type:"primary",onClick:ee},{default:g(()=>[I(P(o(n)("exampleDemo.add")),1)]),_:1}),a(o(c),{loading:M.value,type:"danger",onClick:e[0]||(e[0]=l=>j())},{default:g(()=>[I(P(o(n)("exampleDemo.del")),1)]),_:1},8,["loading"])]),a(o(ie),{pageSize:o(B),"onUpdate:pageSize":[e[1]||(e[1]=l=>J(B)?B.value=l:null),oe],currentPage:o(m),"onUpdate:currentPage":[e[2]||(e[2]=l=>J(m)?m.value=l:null),le],pagination:{total:o(d)},"tree-props":{children:"children"},columns:Y,"default-expand-all":"","node-key":"id",data:o(L),loading:o(h),onRegister:o(V)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1}),a(o(fe),{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),title:p.value},{footer:g(()=>[s.value!=="detail"?(z(),R(o(c),{key:0,type:"primary",loading:D.value,onClick:ae},{default:g(()=>[I(P(o(n)("exampleDemo.save")),1)]),_:1},8,["loading"])):$("",!0),a(o(c),{onClick:e[3]||(e[3]=l=>v.value=!1)},{default:g(()=>[I(P(o(n)("dialogDemo.close")),1)]),_:1})]),default:g(()=>[s.value==="edit"||s.value==="add"?(z(),R(ue,{key:0,ref_key:"writeRef",ref:U,"current-row":x.value},null,8,["current-row"])):$("",!0),s.value==="detail"?(z(),R(de,{key:1,"current-row":x.value},null,8,["current-row"])):$("",!0),s.value==="change"||s.value==="enabled"||s.value==="locked"?(z(),R(me,{key:2,ref_key:"writeRef",ref:U,"current-row":x.value,"action-type":s.value},null,8,["current-row","action-type"])):$("",!0)]),_:1},8,["modelValue","title"])]))}});export{mt as default};
