var b=(z,a,c)=>new Promise((S,v)=>{var _=i=>{try{h(c.next(i))}catch(w){v(w)}},C=i=>{try{h(c.throw(i))}catch(w){v(w)}},h=i=>i.done?S(i.value):Promise.resolve(i.value).then(_,C);h((c=c.apply(z,a)).next())});import{d as Z,g as ee,a as te,u as ae}from"./index-BmpB-Ny1.js";import{u as le}from"./useTable-Upa2w_0L.js";import{I as P,h as D,c as oe}from"./index-CHi5EjGf.js";import{_ as se}from"./Table.vue_vue_type_script_lang-DQd5IUs7.js";/* empty css               *//* empty css                  */import{_ as ne}from"./Search.vue_vue_type_script_setup_true_lang-8pn9kdmB.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-3Xc5l_op.js";import{_ as re}from"./Write.vue_vue_type_script_setup_true_lang-B9-DFvL5.js";import{_ as ue}from"./Detail.vue_vue_type_script_setup_true_lang-CFMpOVUB.js";import{_ as ce}from"./Dialog.vue_vue_type_style_index_0_lang-DbhVjt72.js";import{a as me,g as de}from"./index-ZFJwacTE.js";import{n as pe,a3 as $,k as fe,b as L}from"./element-plus-B2PLgZHf.js";import{v as ge,r as u,V as F,M as l,H as p,x as R,y as ve,K as g,u as s,B as _e,a3 as T,P as E,k as U,J as I,G as V}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-BHRYMbwi.js";/* empty css                         *//* empty css                  */import"./index-BQh6d0I5.js";import"./Form-gS9_0x15.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-BYoZN2oo.js";import"./style.css_vue_type_style_index_0_src_true_lang-C48CRznB.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D8LijxOC.js";import"./IconPicker-BRysFjva.js";import"./IAgree.vue_vue_type_script_setup_true_lang-SWoxqzUy.js";import"./Highlight.vue_vue_type_script_lang-DCoMisvs.js";import"./useForm-D3UcvRwb.js";import"./useIcon-twKurrFj.js";import"./useValidator-CNnCHXsz.js";import"./Descriptions-C1pGrySo.js";/* empty css                  */const he={class:"flex w-100% h-100%"},we={class:"mb-10px"},mt=ge({__name:"Menu",setup(z){const{t:a}=oe(),c=u({}),{tableRegister:S,tableState:v,tableMethods:_}=le({fetchDataApi:()=>b(this,null,function*(){const{currentPage:e,pageSize:t}=v;let o={};return m.value&&m.value.id?o=yield ee(m.value.id):m.value&&m.value.roleId?o=yield me(m.value.roleId):o=yield te(s(e),s(t)),o.data.list=C(o.data),o.data.list.forEach(r=>{r.children.forEach(n=>{n&&n.title&&(c.value[a(n.title)]=n.id)}),r&&r.title&&(c.value[a(r.title)]=r.id)}),{list:o.data.list||[],total:o.data.total||0}})}),C=e=>{if(!e.list||!Array.isArray(e.list))return[];const t=e.list,o=[],r={};return t.forEach(n=>{n.children=n.children||[],r[n.id]=n}),t.forEach(n=>{n.pid&&r[n.pid]?r[n.pid].children.push(n):o.push(n)}),o},{dataList:h,loading:i,total:w,currentPage:x,pageSize:k}=v,{getList:O}=_,G=F([{field:"title",label:a("menu.menuName"),slots:{default:e=>{const t=e.row.title;return l(p,null,[t])}}},{field:"sort",label:a("menu.sort"),slots:{default:e=>l(p,null,[e.row.sort])}},{field:"path",label:a("menu.path")},{field:"component",label:a("menu.component"),slots:{default:e=>l(p,null,[e.row.component])}},{field:"icon",label:a("menu.icon"),slots:{default:e=>{const t=e.row.icon;return t?l(p,null,[l(P,{icon:t},null)]):null}}},{field:"status",label:a("menu.status"),slots:{default:e=>l(p,null,[l(pe,{type:e.row.status?"success":"danger"},{default:()=>[e.row.status?a("userDemo.enable"):a("userDemo.disable")]})])}},{field:"display",label:a("menu.hidden"),slots:{default:e=>l(p,null,[e.row.display?a("menu.false"):a("menu.true")])}},{field:"action",label:a("userDemo.action"),width:120,slots:{default:e=>{const t=e.row;return l(p,null,[l($,{content:"编辑",placement:"top"},{default:()=>[l(D,{size:"small",onClick:()=>J(t,"edit")},{default:()=>[l(P,{icon:"vi-mingcute:edit-line"},null)]})]}),l($,{content:"删除",placement:"top"},{default:()=>[l(D,{size:"small",onClick:()=>j(t)},{default:()=>[l(P,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),H=F([{field:"title",label:a("menu.menuName"),component:"Input"}]),m=u({}),B=e=>{if(e&&e.title){const t=e.title;m.value={id:c.value[t]}}else m.value={roleId:e};O()},f=u(!1),M=u(""),y=u(),d=u(""),N=u(),A=u(!1),J=(e,t)=>{M.value=a("exampleDemo.edit"),d.value=t,y.value=e,f.value=!0},K=()=>{M.value=a("exampleDemo.add"),y.value=void 0,f.value=!0,d.value=""},W=()=>b(this,null,function*(){const e=s(N),t=yield e==null?void 0:e.submit();t&&(A.value=!0,(yield ae(t)).code===200?(_.getList(),A.value=!1,f.value=!1,L({type:"success",message:d.value==="edit"?"修改成功":"添加成功"})):(A.value=!1,L({type:"error",message:"失败"})))}),j=e=>{M.value=a("exampleDemo.del"),d.value="",y.value=e,fe.confirm(a("common.delMessage"),a("common.delWarning"),{confirmButtonText:a("common.delOk"),cancelButtonText:a("common.delCancel"),type:"warning",center:!1}).then(()=>{q(e.id)}).catch(()=>{L({type:"info",message:"Delete canceled"})})},q=e=>b(this,null,function*(){e&&(yield Z({ids:e})).code===200&&(_.getList(),L({type:"success",message:a("common.delSuccess")}))}),Q=u([]);b(this,null,function*(){const e=yield de();e.code===200&&(Q.value=[{id:"all",role:"所有角色",children:e.data.list||[]}])});const X=e=>{x.value=e},Y=e=>{k.value=e};return(e,t)=>(R(),ve("div",he,[l(s(ie),{class:"flex-[3] ml-20px"},{default:g(()=>[l(s(ne),{schema:H,onReset:B,onSearch:B},null,8,["schema"]),_e("div",we,[l(s(D),{type:"primary",onClick:K},{default:g(()=>[T(E(s(a)("exampleDemo.add")),1)]),_:1})]),l(s(se),{pageSize:s(k),"onUpdate:pageSize":[t[0]||(t[0]=o=>U(k)?k.value=o:null),Y],currentPage:s(x),"onUpdate:currentPage":[t[1]||(t[1]=o=>U(x)?x.value=o:null),X],pagination:{total:s(w)},"tree-props":{children:"children"},columns:G,"default-expand-all":"","node-key":"id",data:s(h),loading:s(i),onRegister:s(S)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1}),l(s(ce),{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=o=>f.value=o),title:M.value},{footer:g(()=>[d.value!=="detail"?(R(),I(s(D),{key:0,type:"primary",loading:A.value,onClick:W},{default:g(()=>[T(E(s(a)("exampleDemo.save")),1)]),_:1},8,["loading"])):V("",!0),l(s(D),{onClick:t[2]||(t[2]=o=>f.value=!1)},{default:g(()=>[T(E(s(a)("dialogDemo.close")),1)]),_:1})]),default:g(()=>[d.value!=="detail"?(R(),I(re,{key:0,ref_key:"writeRef",ref:N,"current-row":y.value},null,8,["current-row"])):V("",!0),d.value==="detail"?(R(),I(ue,{key:1,"current-row":y.value},null,8,["current-row"])):V("",!0)]),_:1},8,["modelValue","title"])]))}});export{mt as default};
