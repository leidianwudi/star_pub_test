var oe=Object.defineProperty;var B=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var N=(l,o,r)=>o in l?oe(l,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[o]=r,F=(l,o)=>{for(var r in o||(o={}))se.call(o,r)&&N(l,r,o[r]);if(B)for(var r of B(o))le.call(o,r)&&N(l,r,o[r]);return l};var y=(l,o,r)=>new Promise((b,p)=>{var v=m=>{try{d(r.next(m))}catch(f){p(f)}},T=m=>{try{d(r.throw(m))}catch(f){p(f)}},d=m=>m.done?b(m.value):Promise.resolve(m.value).then(v,T);d((r=r.apply(l,o)).next())});import{u as re}from"./useTable-YuVhaX40.js";import{r as C,h as _,I,c as ne,_ as ie}from"./index-YGSL2gxf.js";import{_ as ue}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";import{_ as me}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import"./IconPicker-Bnk7u0qr.js";/* empty css                   */import{af as P,a3 as U,p as de,q as pe,b as w}from"./element-plus-B2PLgZHf.js";import{_ as fe}from"./Write.vue_vue_type_script_setup_true_lang-DvtUacmD.js";import{_ as ge}from"./Dialog.vue_vue_type_style_index_0_lang-DNc9B0lB.js";import{v as ye,r as i,V as W,j as _e,M as n,H,u as s,x as Y,y as ve,K as c,B as De,a3 as V,P as z,k as j,J as q,G}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";/* empty css                  */const ke=l=>C.post({url:"/system_task/select",data:{page:l.page,pageNum:l.pageSize,create_at_min:l.create_at_min,create_at_max:l.create_at_max}}),we=l=>C.post({url:"/system_task/update",data:l}),be=l=>C.post({url:"/system_task/delete",data:{ids:l}}),Te={class:"mb-10px"},he=ye({__name:"SystemTask",setup(l){const{t:o}=ne(),r=i("daily"),b=W([{field:"dateRange",label:o("router.systemTaskModule.dateRange"),component:"DatePicker",componentProps:{type:"daterange","range-separator":"-","start-placeholder":o("router.systemTaskModule.startDate"),"end-placeholder":o("router.systemTaskModule.endDate"),shortcuts:[{text:o("router.systemTaskModule.today"),value:()=>{const e=new Date;return[e,e]}},{text:o("router.systemTaskModule.yesterday"),value:()=>{const e=new Date;return e.setDate(e.getDate()-1),[e,e]}},{text:o("router.systemTaskModule.thisWeek"),value:()=>{const e=new Date;return[new Date(e.setDate(e.getDate()-e.getDay()+(e.getDay()===0?-6:1))),new Date]}},{text:o("router.systemTaskModule.thisMonth"),value:()=>{const e=new Date;return[new Date(e.getFullYear(),e.getMonth(),1),new Date]}}]}}]),p=i({}),v=e=>{p.value=e,h()},{tableRegister:T,tableState:d,tableMethods:m}=re({fetchDataApi:()=>y(this,null,function*(){const{currentPage:e,pageSize:t}=d,a=F({page:s(e),pageSize:s(t)},s(p));a.dateRange&&a.dateRange.length===2&&(a.create_at_min=P(a.dateRange[0]).format("YYYY-MM-DD"),a.create_at_max=P(a.dateRange[1]).format("YYYY-MM-DD"),delete a.dateRange);const u=yield ke(a);return{list:u.data.list||[],total:u.data.total||0}}),fetchDelApi:()=>y(this,null,function*(){return!!(yield be(s(R)))})}),{dataList:f,loading:J,total:K,currentPage:D,pageSize:k}=d,{getList:h,getElTableExpose:O,delList:Q}=m;_e(()=>{h()});const X=W([{field:"selection",type:"selection"},{field:"code",label:"任务编码",minWidth:"120px"},{field:"title",label:"任务名称",minWidth:"150px"},{field:"create_at",label:"任务时间",width:"180px",formatter:(e,t,a)=>P(a).format("YYYY-MM-DD HH:mm:ss")},{field:"desc",label:"任务说明",minWidth:"200px",showOverflowTooltip:!0},{field:"action",label:o("userDemo.action"),width:120,slots:{default:e=>{const t=e.row;return n(H,null,[n(U,{content:"编辑",placement:"top"},{default:()=>[n(_,{size:"small",onClick:()=>Z(t,"edit")},{default:()=>[n(I,{icon:"vi-mingcute:edit-line"},null)]})]}),n(U,{content:"删除",placement:"top"},{default:()=>[n(_,{size:"small",onClick:()=>A(t)},{default:()=>[n(I,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),g=i(!1),$=i(""),E=i(),x=i(""),Z=(e,t)=>{$.value=o("exampleDemo.edit"),x.value=t,E.value=e,g.value=!0},L=i(),M=i(!1),ee=()=>y(this,null,function*(){var t;const e=s(L);try{const a=yield e==null?void 0:e.submit();if(!a)return;M.value=!0,w({message:"正在保存...",type:"info",duration:0});const u=yield we(a);if((u==null?void 0:u.code)===200)w.closeAll(),w.success("操作成功"),g.value=!1,yield h();else throw new Error(((t=u==null?void 0:u.data)==null?void 0:t.message)||"操作失败")}catch(a){console.error("操作失败:",a),w.error(a.message||"操作失败")}finally{M.value=!1}}),S=i(!1),R=i([]),A=e=>y(this,null,function*(){const t=yield O();R.value=e?[e.id]:(t==null?void 0:t.getSelectionRows().map(a=>a.id))||[],S.value=!0,yield Q(s(R).length).finally(()=>{S.value=!1})});i(!1);const te=e=>{D.value=e},ae=e=>{k.value=e};return(e,t)=>(Y(),ve(H,null,[n(s(ce),{title:s(o)("router.systemTask")},{default:c(()=>[n(s(de),{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=a=>r.value=a),type:"card"},{default:c(()=>[n(s(pe),{label:s(o)("router.systemTaskModule.dailyStats"),name:"daily"},{default:c(()=>[n(s(me),{schema:b,onReset:v,onSearch:v},null,8,["schema"]),De("div",Te,[n(s(_),{loading:S.value,type:"danger",onClick:t[0]||(t[0]=a=>A())},{default:c(()=>[V(z(s(o)("exampleDemo.del")),1)]),_:1},8,["loading"])]),n(s(ue),{pageSize:s(k),"onUpdate:pageSize":[t[1]||(t[1]=a=>j(k)?k.value=a:null),ae],currentPage:s(D),"onUpdate:currentPage":[t[2]||(t[2]=a=>j(D)?D.value=a:null),te],pagination:{total:s(K)},columns:X,data:s(f),loading:s(J),onRegister:s(T)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["title"]),n(s(ge),{modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=a=>g.value=a),title:$.value},{footer:c(()=>[x.value!=="detail"?(Y(),q(s(_),{key:0,type:"primary",loading:M.value,onClick:ee},{default:c(()=>[V(z(s(o)("exampleDemo.save")),1)]),_:1},8,["loading"])):G("",!0),n(s(_),{onClick:t[4]||(t[4]=a=>g.value=!1)},{default:c(()=>[V(z(s(o)("dialogDemo.close")),1)]),_:1})]),default:c(()=>[x.value==="edit"?(Y(),q(fe,{key:0,ref_key:"writeRef",ref:L,"current-row":E.value},null,8,["current-row"])):G("",!0)]),_:1},8,["modelValue","title"])],64))}}),mt=ie(he,[["__scopeId","data-v-9bfb6b05"]]);export{mt as default};
