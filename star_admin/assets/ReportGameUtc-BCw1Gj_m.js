var f=(P,c,n)=>new Promise((v,u)=>{var h=l=>{try{d(n.next(l))}catch(i){u(i)}},S=l=>{try{d(n.throw(l))}catch(i){u(i)}},d=l=>l.done?v(l.value):Promise.resolve(l.value).then(h,S);d((n=n.apply(P,c)).next())});import{u as C}from"./useTable-YuVhaX40.js";import{c as E}from"./index-YGSL2gxf.js";import{_ as K}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";import{_ as L}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as I}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import{l as A,a as V,g as j,m as H}from"./index-DOJE_sUj.js";import{v as Y,r as w,u as o,V as D,M as b,H as q,j as J,x as O,y as Q,K as W,k as T}from"./vue-chunks-COp0tDkU.js";import"./element-plus-B2PLgZHf.js";/* empty css                    *//* empty css                   *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IconPicker-Bnk7u0qr.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";const X={class:"flex w-100% h-100%"},Ce=Y({__name:"ReportGameUtc",setup(P){const{t:c}=E(),n=w({}),{tableRegister:v,tableState:u,tableMethods:h}=C({fetchDataApi:()=>f(this,null,function*(){const{currentPage:e,pageSize:a}=u;let r={};return m.value&&m.value.game_code||m.value.day_min||m.value.type_code?r=yield A(o(e),o(a),m.value):(r=yield A(o(e),o(a)),r.data.list.forEach(t=>{t&&t.gameBase&&(n.value[c(t.gameBase.name)]=t.game_code)})),{list:r.data.list||[],total:r.data.total||0}})}),{dataList:S,loading:d,total:l,currentPage:i,pageSize:_}=u,{getList:z}=h,B=D([{field:"utc",label:"时区"},{field:"day",label:"日期"},{field:"type_code",label:"游戏类型编码"},{field:"game_code",label:"游戏编码"},{field:"name",label:"游戏名称",slots:{default:e=>{const a=e.row;return b(q,null,[a.gameBase.name])}}},{field:"spend",label:"花费"},{field:"win",label:"奖励"},{field:"final",label:"结果"},{field:"play_num",label:"玩次数"},{field:"room_num",label:"房间数"},{field:"rtp",label:"普通rtp"},{field:"rtp_big",label:"幸运时刻rtp"}]),$=D([{field:"name",label:"游戏名称",component:"Select",componentProps:{nodeKey:"name",props:{label:e=>{if(e&&e.name)return c(e.name)},value:"name"},checkStrictly:!0},optionApi:()=>f(this,null,function*(){return(yield V()).data.list||[]})},{field:"type_code",label:"游戏类型",component:"Select",componentProps:{nodeKey:"type_code",props:{label:e=>{if(e&&e.type_code)return c(e.type_code)},value:"type_code"},checkStrictly:!0},optionApi:()=>f(this,null,function*(){return(yield j()).data.list||[]})},{field:"day_min",label:"起始时间",component:"DatePicker"},{field:"day_max",label:"结束时间",component:"DatePicker"}]),m=w({}),N=e=>{e&&(e.day_min||e.name)?(e.day_max||(e.day_max=e.day_min),m.value=e.day_min?{type_code:e.type_code,game_code:n.value[e.name],day_min:R(new Date(e.day_min)),day_max:R(new Date(e.day_max))}:{type_code:e.type_code,game_code:n.value[e.name]}):m.value=e,z()},R=e=>{const a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${a}-${r}-${t}`},G=e=>{i.value=e},M=e=>{_.value=e},U=e=>{const{columns:a,data:r}=e,t=[];return a.forEach((g,s)=>{if(s===0){t[s]="总计";return}if(["spend","win","final","play_num","room_num","rtp","rtp_big"].includes(g.property))if(y.value&&y.value.list[0][g.property]!==void 0)t[s]=Number(y.value.list[0][g.property]).toFixed(2);else{const k=e.data.map(p=>Number(p[g.property]));k.every(p=>isNaN(p))?t[s]="N/A":(t[s]=k.reduce((p,F)=>{const x=Number(F);return isNaN(x)?p:p+x},0),t[s]=t[s].toFixed(2))}else t[s]=""}),t},y=w(null);return J(()=>f(this,null,function*(){try{const e=yield H();y.value=e.data}catch(e){console.error("获取游戏报表总计数据失败:",e)}})),(e,a)=>(O(),Q("div",X,[b(o(I),{class:"flex-[3] ml-20px"},{default:W(()=>[b(o(L),{schema:$,onReset:N,onSearch:N},null,8,["schema"]),b(o(K),{pageSize:o(_),"onUpdate:pageSize":[a[0]||(a[0]=r=>T(_)?_.value=r:null),M],currentPage:o(i),"onUpdate:currentPage":[a[1]||(a[1]=r=>T(i)?i.value=r:null),G],pagination:{total:o(l)},"tree-props":{children:"children"},columns:B,"default-expand-all":"","node-key":"id",data:o(S),loading:o(d),onRegister:o(v),"show-summary":"","summary-method":U},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1})]))}});export{Ce as default};
