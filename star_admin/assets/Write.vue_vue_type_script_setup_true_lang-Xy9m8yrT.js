var S=Object.defineProperty;var D=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var E=(n,s,e)=>s in n?S(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,M=(n,s)=>{for(var e in s||(s={}))V.call(s,e)&&E(n,e,s[e]);if(D)for(var e of D(s))P.call(s,e)&&E(n,e,s[e]);return n};var R=(n,s,e)=>new Promise((g,d)=>{var p=l=>{try{k(e.next(l))}catch(w){d(w)}},x=l=>{try{k(e.throw(l))}catch(w){d(w)}},k=l=>l.done?g(l.value):Promise.resolve(l.value).then(p,x);k((e=e.apply(n,s)).next())});import{F as B}from"./Form-BurHqMWS.js";import{u as j}from"./useForm-dGPra2nm.js";import{u as q}from"./useValidator-DY0gbKVw.js";import{c as H,A as J}from"./index-YGSL2gxf.js";/* empty css                *//* empty css                    */import{b as O}from"./index-BcVtqPiW.js";import{e as _,f as W}from"./tree-Dgaev6Pi.js";import{a as z}from"./index-BTBuQ87_.js";import{ae as G}from"./element-plus-B2PLgZHf.js";import{v as Q,r as y,M as b,H as U,V as X,w as Y,x as Z,J as $,u as h}from"./vue-chunks-COp0tDkU.js";const fe=Q({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(n,{expose:s}){const{t:e}=H(),{required:g}=q(),d=n,p=y(),x=y([{field:"role",label:e("role.roleName"),component:"Input"},{field:"status",label:e("menu.status"),component:"Select",componentProps:{options:[{label:e("userDemo.disable"),value:0},{label:e("userDemo.enable"),value:1}]}},{field:"remark",label:e("role.remark"),component:"Input"},{field:"menu",label:e("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>b(U,null,[b("div",{class:"flex w-full"},[b("div",{class:"flex-1"},[b(G,{ref:p,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,data:v.value,"onNode-click":l},{default:t=>b("span",null,[e(t.data.title)])})])])])}}}]),k=y(),l=t=>{k.value=t},w=X({roleName:[g()],role:[g()],status:[g()]}),{formRegister:I,formMethods:C}=j(),{setValues:F,getFormData:T,getElFormExpose:K}=C,v=y([]);R(this,null,function*(){var u,a;const t=yield O();t.code&&(t.data.list=A(t.data));let i=t;if(d.currentRow&&(i=yield z(d.currentRow.id),i.code==200&&(i.data.list=A(i.data))),t){if(v.value=t.data.list,!d.currentRow)return;const r=[];_(i.data.list,o=>{var m;r.push({id:o.id,permission:((m=o.meta)==null?void 0:m.permission)||[]})}),_(v.value,o=>{const m=J(r,f=>f.id===o.id);if(m>-1){const f=M({},o.meta||{});f.permission=r[m].permission,o.meta=f}});for(const o of r)(u=h(p))==null||u.setChecked(o.id,!0,!1);(a=h(p))==null||a.setCheckedKeys(r.map(o=>o.id),!1)}});const A=t=>{if(!t.list||!Array.isArray(t.list))return[];const i=t.list,u=[],a={};return i.forEach(r=>{r.children=r.children||[],a[r.id]=r}),i.forEach(r=>{r.pid&&a[r.pid]?a[r.pid].children.push(r):u.push(r)}),u},L=()=>R(this,null,function*(){var u;const t=yield K();if(yield t==null?void 0:t.validate().catch(a=>{})){const a=yield T(),r=((u=h(p))==null?void 0:u.getCheckedKeys())||[],o=W(h(v),c=>r.includes(c.id));a["treeArray:"]=[];const m=new Set(r),f=c=>{m.has(c.id)&&a["treeArray:"].push(c.path),c.children&&c.children.length>0&&c.children.forEach(N=>{f(N)})};return o.forEach(c=>f(c)),a}});return Y(()=>d.currentRow,t=>{t&&F(t)},{deep:!0,immediate:!0}),s({submit:L}),(t,i)=>(Z(),$(h(B),{rules:w,onRegister:h(I),schema:x.value},null,8,["rules","onRegister","schema"]))}});export{fe as _};
