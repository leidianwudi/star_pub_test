var oe=Object.defineProperty;var F=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var I=(s,i,n)=>i in s?oe(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n,U=(s,i)=>{for(var n in i||(i={}))ne.call(i,n)&&I(s,n,i[n]);if(F)for(var n of F(i))ie.call(i,n)&&I(s,n,i[n]);return s};var g=(s,i,n)=>new Promise((C,v)=>{var x=u=>{try{b(n.next(u))}catch(y){v(y)}},z=u=>{try{b(n.throw(u))}catch(y){v(y)}},b=u=>u.done?C(u.value):Promise.resolve(u.value).then(x,z);b((n=n.apply(s,i)).next())});import{h as d,I as T}from"./index-YGSL2gxf.js";import{_ as se}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";import{u as re}from"./useTable-YuVhaX40.js";/* empty css               *//* empty css                   */import{_ as ue}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import{_ as me}from"./Write.vue_vue_type_script_setup_true_lang-CmvmmEsH.js";import{_ as de}from"./Dialog.vue_vue_type_style_index_0_lang-DNc9B0lB.js";import{b as pe,c as fe,e as W}from"./index-D7Tnk3Vo.js";import{n as ge,a3 as $,k as ve,b as c}from"./element-plus-B2PLgZHf.js";import{v as be,r as m,u as l,V as j,M as o,H as h,x as A,y as ye,K as p,B as we,a3 as _,P as L,k as G,J as H,G as J}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IconPicker-Bnk7u0qr.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";/* empty css                  */const Se={class:"mb-10px"},st=be({__name:"index",setup(s){const i=m([]),n=m({}),{tableRegister:C,tableState:v,tableMethods:x}=re({fetchDataApi:()=>g(this,null,function*(){const{currentPage:a,pageSize:e}=v,t=U({page:l(a),pageSize:l(e)},l(n)),r=yield pe(t);return{list:r.data.list||[],total:r.data.total||0}}),fetchDelApi:()=>g(this,null,function*(){return!!(yield fe(l(i)))})}),z=j([{field:"item_code",label:"道具编号",component:"Input"}]),{dataList:b,loading:u,total:y,currentPage:S,pageSize:k}=v,{getList:P,getElTableExpose:K,delList:O}=x,q=j([{field:"selection",type:"selection"},{field:"day",label:"第几天"},{field:"title",label:"名称"},{field:"tip",label:"客户端提示"},{field:"item_code",label:"道具编号"},{field:"reward",label:"奖励数量"},{field:"enable",label:"是否起效",slots:{default:a=>o(h,null,[o(ge,{type:a.row.enable?"success":"danger"},{default:()=>[a.row.enable?"开启":"关闭"]})])}},{field:"desc",label:"备注"},{field:"action",label:"操作",width:180,slots:{default:a=>{const e=a.row;return o(h,null,[o($,{content:"编辑",placement:"top"},{default:()=>[o(d,{size:"small",onClick:()=>Z(e,"edit")},{default:()=>[o(T,{icon:"vi-mingcute:edit-line"},null)]})]}),o($,{content:Q(e.enable),placement:"top"},{default:()=>[o(d,{size:"small",onClick:()=>X(e)},{default:()=>[o(T,{icon:"vi-ep:open"},null)]})]}),o($,{content:"删除",placement:"top"},{default:()=>[o(d,{size:"small",onClick:()=>M(e)},{default:()=>[o(T,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),Q=a=>a===0?"开启":"关闭",X=a=>{let e="是否关闭";a.enable===0&&(e="是否开启"),ve.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!1}).then(()=>{const t=Object.assign({},a);t.enable=t.enable===0?1:0,Y(t)}).catch(()=>{c({type:"info",message:"取消修改状态"})})},Y=a=>g(this,null,function*(){var e;try{c({message:"正在更新状态...",type:"info",duration:0});const t=yield W(a);if((t==null?void 0:t.code)===200)c.closeAll(),c.success("状态更新成功"),yield P();else throw new Error(((e=t==null?void 0:t.data)==null?void 0:e.message)||"更新状态失败")}catch(t){console.error("更新状态失败:",t),c.error(t.message||"更新状态失败")}}),f=m(!1),R=m(""),V=m(),w=m(""),Z=(a,e)=>{R.value="编辑",w.value=e,V.value=a,f.value=!0},D=m(),B=m(!1),ee=()=>g(this,null,function*(){var e;const a=l(D);try{const t=yield a==null?void 0:a.submit();if(!t)return;B.value=!0,t.desc||(t.desc=""),t.id||(t.enable=1),c({message:"正在保存...",type:"info",duration:0});const r=yield W(t);if((r==null?void 0:r.code)===200)c.closeAll(),c.success("操作成功"),f.value=!1,yield P();else throw new Error(((e=r==null?void 0:r.data)==null?void 0:e.message)||"操作失败")}catch(t){console.error("操作失败:",t),c.error(t.message||"操作失败")}finally{B.value=!1}}),E=m(!1),M=a=>g(this,null,function*(){const e=yield K();i.value=a?[a.id]:(e==null?void 0:e.getSelectionRows().map(t=>t.id))||[],E.value=!0,yield O(l(i).length).finally(()=>{E.value=!1})}),te=()=>{R.value="新增",V.value=void 0,f.value=!0,w.value="add"},N=a=>{n.value=a,P()},ae=a=>{S.value=a},le=a=>{k.value=a};return(a,e)=>(A(),ye(h,null,[o(l(ce),null,{default:p(()=>[o(l(ue),{schema:z,onReset:N,onSearch:N},null,8,["schema"]),we("div",Se,[o(l(d),{type:"primary",onClick:te},{default:p(()=>e[5]||(e[5]=[_(L("新增"))])),_:1}),o(l(d),{loading:E.value,type:"danger",onClick:e[0]||(e[0]=t=>M())},{default:p(()=>e[6]||(e[6]=[_("删除")])),_:1},8,["loading"])]),o(l(se),{pageSize:l(k),"onUpdate:pageSize":[e[1]||(e[1]=t=>G(k)?k.value=t:null),le],currentPage:l(S),"onUpdate:currentPage":[e[2]||(e[2]=t=>G(S)?S.value=t:null),ae],pagination:{total:l(y)},columns:q,data:l(b),loading:l(u),onRegister:l(C)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1}),o(l(de),{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),title:R.value},{footer:p(()=>[w.value!=="detail"?(A(),H(l(d),{key:0,type:"primary",loading:B.value,onClick:ee},{default:p(()=>e[7]||(e[7]=[_(L("保存"))])),_:1},8,["loading"])):J("",!0),o(l(d),{onClick:e[3]||(e[3]=t=>f.value=!1)},{default:p(()=>e[8]||(e[8]=[_(L("关闭"))])),_:1})]),default:p(()=>[w.value==="edit"||w.value==="add"?(A(),H(me,{key:0,ref_key:"writeRef",ref:D,"current-row":V.value},null,8,["current-row"])):J("",!0)]),_:1},8,["modelValue","title"])],64))}});export{st as default};
