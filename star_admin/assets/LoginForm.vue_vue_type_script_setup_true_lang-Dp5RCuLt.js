var J=Object.defineProperty;var E=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var z=(a,n,t)=>n in a?J(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,F=(a,n)=>{for(var t in n||(n={}))$.call(n,t)&&z(a,t,n[t]);if(E)for(var t of E(n))G.call(n,t)&&z(a,t,n[t]);return a};var w=(a,n,t)=>new Promise((P,p)=>{var i=c=>{try{g(t.next(c))}catch(f){p(f)}},d=c=>{try{g(t.throw(c))}catch(f){p(f)}},g=c=>c.done?P(c.value):Promise.resolve(c.value).then(i,d);g((t=t.apply(a,n)).next())});import{F as Q}from"./Form-BurHqMWS.js";import{u as W,k as X,d as Y,h as L,I as v,l as Z,m as ee,n as oe,c as te}from"./index-YGSL2gxf.js";/* empty css                    *//* empty css                */import{u as se}from"./useForm-dGPra2nm.js";import{v as re,V as ae,M as r,H as A,r as D,j as ne,w as le,u as y,x as ie,J as ce,a7 as de,az as ue}from"./vue-chunks-COp0tDkU.js";import{u as pe}from"./useValidator-DY0gbKVw.js";import{B as me,w as fe}from"./element-plus-B2PLgZHf.js";function x(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!de(a)}const R=30,b="#999",I="var(--el-color-primary)",ke=re({__name:"LoginForm",emits:["to-register"],setup(a,{emit:n}){const{required:t}=pe(),P=n,p=W(),i=X(),d=Y(),{currentRoute:g,addRoute:c,push:f}=ue(),{t:m}=te(),V={username:[t()],password:[t()]},j=ae([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>r("h2",{class:"text-2xl font-bold text-center w-[100%]"},[m("login.login")])}}},{field:"username",label:m("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:m("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test",onKeydown:e=>{e.key==="Enter"&&(e.stopPropagation(),C())}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return r(A,null,[r("div",{class:"flex justify-between items-center w-[100%]"},[r(me,{modelValue:h.value,"onUpdate:modelValue":o=>h.value=o,label:m("login.remember"),size:"small"},null),r(fe,{type:"primary",underline:!1},x(e=m("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return r(A,null,[r("div",{class:"w-[100%]"},[r(L,{loading:k.value,type:"primary",class:"w-[100%]",onClick:C},x(e=m("login.login"))?e:{default:()=>[e]})]),r("div",{class:"w-[100%] mt-15px"},[r(L,{class:"w-[100%]",onClick:T},x(o=m("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:m("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>r(A,null,[r("div",{class:"flex justify-between w-[100%]"},[r(v,{icon:"vi-ant-design:github-filled",size:R,class:"cursor-pointer ant-icon",color:b,hoverColor:I},null),r(v,{icon:"vi-ant-design:wechat-filled",size:R,class:"cursor-pointer ant-icon",color:b,hoverColor:I},null),r(v,{icon:"vi-ant-design:alipay-circle-filled",size:R,color:b,hoverColor:I,class:"cursor-pointer ant-icon"},null),r(v,{icon:"vi-ant-design:weibo-circle-filled",size:R,color:b,hoverColor:I,class:"cursor-pointer ant-icon"},null)])])}}}]),h=D(i.getRememberMe),M=()=>{const e=i.getLoginInfo;if(e){const{username:o,password:l}=e;U({username:o,password:l})}};ne(()=>{M()});const{formRegister:q,formMethods:B}=se(),{getFormData:S,getElFormExpose:N,setValues:U}=B,k=D(!1),_=D("");le(()=>g.value,e=>{var o;_.value=(o=e==null?void 0:e.query)==null?void 0:o.redirect},{immediate:!0});const C=()=>w(this,null,function*(){const e=yield N();yield e==null?void 0:e.validate(o=>w(this,null,function*(){if(o){k.value=!0;const l=yield S();try{const u=yield Z(F({},l));u&&(y(h)?i.setLoginInfo({username:l.username,password:l.password}):i.setLoginInfo(void 0),i.setRememberMe(y(h)),i.setTokenKey(u.data.token),i.setUserInfo(l),p.getDynamicRouter?K():(yield d.generateRoutes("static").catch(()=>{}),d.getAddRouters.forEach(s=>{c(s)}),d.setIsAddRouters(!0),f({path:_.value||"/dashboard/workplace"})))}finally{k.value=!1}}}))}),K=()=>w(this,null,function*(){const o={roleName:(yield S()).username},l=yield ee(o);l.data=O(l.data);const u=p.getDynamicRouter&&p.getServerDynamicRouter?l:yield oe(o);if(u){const s=u.data||[];i.setRoleRouters(s),p.getDynamicRouter&&p.getServerDynamicRouter?yield d.generateRoutes("server",s).catch(()=>{}):yield d.generateRoutes("frontEnd",s).catch(()=>{}),d.getAddRouters.forEach(H=>{c(H)}),d.setIsAddRouters(!0),f({path:_.value||"/dashboard/workplace"})}}),O=e=>{if(!e.list||!Array.isArray(e.list))return[];const o=e.list,l=[],u={};return o.forEach(s=>{s.children=s.children||[],u[s.id]=s}),o.forEach(s=>{s.pid&&u[s.pid]?u[s.pid].children.push(s):l.push(s)}),l},T=()=>{P("to-register")};return(e,o)=>(ie(),ce(y(Q),{schema:j,rules:V,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:y(q)},null,8,["schema","onRegister"]))}});export{ke as _};
