var y=(i,n,p)=>new Promise((L,C)=>{var h=d=>{try{x(p.next(d))}catch(m){C(m)}},N=d=>{try{x(p.throw(d))}catch(m){C(m)}},x=d=>d.done?L(d.value):Promise.resolve(d.value).then(h,N);x((p=p.apply(i,n)).next())});import{u as ne}from"./useTable-YuVhaX40.js";import{r as E,c as ie,h as r,I as g}from"./index-YGSL2gxf.js";import{_ as se}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";/* empty css               *//* empty css                   */import{_ as re}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as ue}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import{_ as ce}from"./Write.vue_vue_type_script_setup_true_lang-yYVufZj4.js";import{_ as de}from"./Detail.vue_vue_type_script_setup_true_lang-C7nTRXjY.js";import{_ as me}from"./ChangePassword.vue_vue_type_script_setup_true_lang-Bf1rIc_6.js";import{_ as fe}from"./Dialog.vue_vue_type_style_index_0_lang-DNc9B0lB.js";import{_ as pe}from"./WriteCoin.vue_vue_type_script_setup_true_lang-L2sU5RmL.js";import{n as M,a3 as v,k as ge,b as T}from"./element-plus-B2PLgZHf.js";import{v as ve,r as c,u as o,V as H,M as a,H as z,x as w,y as be,K as b,B as ke,a3 as U,P as V,k as J,J as B,G as D}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IconPicker-Bnk7u0qr.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";import"./useValidator-DY0gbKVw.js";import"./Descriptions-CGScbuMD.js";/* empty css                  */function _e(i,n){return E.post({url:"/user/select",data:{page:i,pageNum:n}})}function ye(i){return E.post({url:"/user/selectById",data:{id:i},headers:{"Cache-Control":"no-cache"}})}function K(i){return E.post({url:"/user/update",data:i})}function we(i){return E.post({url:"/user/actionCoin",data:i})}const Ce=i=>E.post({url:"/user/delete",data:{ids:i}}),he={class:"flex w-100% h-100%"},xe={class:"mb-10px"},gt=ve({__name:"GamesUser",setup(i){const{t:n}=ie(),p=c({}),{tableRegister:L,tableState:C,tableMethods:h}=ne({fetchDataApi:()=>y(this,null,function*(){const{currentPage:t,pageSize:e}=C;let l={};return S.value&&S.value.id?(l=yield ye(S.value.id),l.code===200&&(l.data.list=[l.data])):(l=yield _e(o(t),o(e)),l.data.list.forEach(u=>{u&&u.account&&(p.value[n(u.account)]=u.id)})),{list:l.data.list||[],total:l.data.total||0}}),fetchDelApi:()=>y(this,null,function*(){return!!(yield Ce(o(A)))})}),{dataList:N,loading:x,total:d,currentPage:m,pageSize:R}=C,{getList:Q,getElTableExpose:W,delList:X}=h,Y=H([{field:"selection",type:"selection"},{field:"account",label:"账号"},{field:"token",label:"token"},{field:"name",label:"昵称"},{field:"lv",label:"等级"},{field:"visualId",label:"头像Id"},{field:"gender",label:"性别",slots:{default:t=>{let e="保密";return t.row.gender===1?e="男":t.row.gender===2&&(e="女"),a(z,null,[e])}}},{field:"introduction",label:"简介"},{field:"coin",label:"金币"},{field:"deleted",label:"是否删除",slots:{default:t=>a(M,{type:t.row.deleted?"success":"danger"},{default:()=>[a(z,null,[t.row.deleted?"是":"否"])]})}},{field:"failed_attempts",label:"密码失败次数"},{field:"last_attempt_time",label:"最后一次失败时间"},{field:"locked",label:"是否已经冻结",slots:{default:t=>a(M,{type:t.row.locked?"danger":"success"},{default:()=>[a(z,null,[t.row.locked?"冻结":"正常"])]})}},{field:"lock_until",label:"冻结持续到"},{field:"enable",label:"是否启用",slots:{default:t=>a(M,{type:t.row.enable?"success":"danger"},{default:()=>[a(z,null,[t.row.enable?"启用":"禁用"])]})}},{field:"diamond",label:"钻石数量"},{field:"total_bet",label:"消耗金币总量"},{field:"max_bet_one_time",label:"单次最大投注额"},{field:"action",label:n("userDemo.action"),width:380,slots:{default:t=>{const e=t.row;return a(z,null,[a(v,{content:"详情",placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>P(e,"detail")},{default:()=>[a(g,{icon:"vi-bx:detail"},null)]})]}),a(v,{content:"修改密码",placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>P(e,"change")},{default:()=>[a(g,{icon:"vi-material-symbols:passkey-rounded"},null)]})]}),a(v,{content:G(e.locked,"locked"),placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>q(e,"locked")},{default:()=>[a(g,{icon:"vi-game-icons:frozen-orb"},null)]})]}),a(v,{content:G(e.enable,"enabled"),placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>q(e,"enabled")},{default:()=>[a(g,{icon:"vi-material-symbols:person-add-disabled-outline-rounded"},null)]})]}),a(v,{content:"编辑",placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>P(e,"edit")},{default:()=>[a(g,{icon:"vi-mingcute:edit-line"},null)]})]}),a(v,{content:"增减金币",placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>P(e,"editCoin")},{default:()=>[a(g,{icon:"vi-ant-design:gold-outlined"},null)]})]}),a(v,{content:"删除",placement:"top"},{default:()=>[a(r,{size:"small",onClick:()=>j(e)},{default:()=>[a(g,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),Z=H([{field:"account",label:"账号",component:"Input"}]),G=(t,e)=>t===0?e==="locked"?"冻结":"启用":e==="locked"?"解冻":"禁用",S=c({}),O=t=>{if(t&&t.account){const e=t.account;S.value={id:p.value[e]}}else S.value=t;Q()},k=c(!1),f=c(""),_=c(),s=c(""),$=c(),I=c(!1),P=(t,e)=>{switch(e){case"edit":f.value="编辑";break;case"detail":f.value="用户详情";break;case"change":f.value="修改密码";break;case"locked":f.value="修改冻结状态";break;case"enabled":f.value="修改账户状态";break;case"editCoin":f.value="增减金币";break}s.value=e,_.value=t,k.value=!0},ee=()=>{f.value=n("exampleDemo.add"),_.value=void 0,k.value=!0,s.value="add"},A=c([]),F=c(!1),j=t=>y(this,null,function*(){const e=yield W();A.value=t?[t.id]:(e==null?void 0:e.getSelectionRows().map(l=>l.id))||[],F.value=!0,yield X(o(A).length).finally(()=>{F.value=!1})}),q=(t,e)=>{let l="是否冻结用户";t.locked===1&&(l="是否解冻用户"),e==="enabled"&&(t.enable===0?l="是否启用账户":l="是否禁用账户"),ge.confirm(l,"提示",{confirmButtonText:n("common.delOk"),cancelButtonText:n("common.delCancel"),type:"warning",center:!1}).then(()=>{const u=Object.assign({},t);e==="locked"?u.locked=u.locked===0?1:0:u.enable=u.enable===0?1:0,te(u)}).catch(()=>{T({type:"info",message:"取消修改状态"})})},te=t=>y(this,null,function*(){try{(yield K(t)).code===200&&(h.refresh(),T({type:"success",message:"修改成功"}))}catch(e){}}),ae=()=>y(this,null,function*(){const t=o($),e=yield t==null?void 0:t.submit();if(e){I.value=!0;let l=null;e.edit_coin?(e.edit_coin=Number(e.edit_coin),l=yield we(e)):l=yield K(e),l.code===200?(h.getList(),I.value=!1,k.value=!1,T({type:"success",message:s.value==="add"?"添加成功":"修改成功"})):(I.value=!1,T({type:"error",message:"失败"}))}}),le=t=>{m.value=t},oe=t=>{R.value=t};return(t,e)=>(w(),be("div",he,[a(o(ue),{class:"flex-[3] ml-20px"},{default:b(()=>[a(o(re),{schema:Z,onReset:O,onSearch:O},null,8,["schema"]),ke("div",xe,[a(o(r),{type:"primary",onClick:ee},{default:b(()=>[U(V(o(n)("exampleDemo.add")),1)]),_:1}),a(o(r),{loading:F.value,type:"danger",onClick:e[0]||(e[0]=l=>j())},{default:b(()=>[U(V(o(n)("exampleDemo.del")),1)]),_:1},8,["loading"])]),a(o(se),{pageSize:o(R),"onUpdate:pageSize":[e[1]||(e[1]=l=>J(R)?R.value=l:null),oe],currentPage:o(m),"onUpdate:currentPage":[e[2]||(e[2]=l=>J(m)?m.value=l:null),le],pagination:{total:o(d)},"tree-props":{children:"children"},columns:Y,"default-expand-all":"","node-key":"id",data:o(N),loading:o(x),onRegister:o(L)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1}),a(o(fe),{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=l=>k.value=l),title:f.value},{footer:b(()=>[s.value!=="detail"?(w(),B(o(r),{key:0,type:"primary",loading:I.value,onClick:ae},{default:b(()=>[U(V(o(n)("exampleDemo.save")),1)]),_:1},8,["loading"])):D("",!0),a(o(r),{onClick:e[3]||(e[3]=l=>k.value=!1)},{default:b(()=>[U(V(o(n)("dialogDemo.close")),1)]),_:1})]),default:b(()=>[s.value==="edit"||s.value==="add"?(w(),B(ce,{key:0,ref_key:"writeRef",ref:$,"current-row":_.value},null,8,["current-row"])):D("",!0),s.value==="editCoin"?(w(),B(pe,{key:1,ref_key:"writeRef",ref:$,"current-row":_.value},null,8,["current-row"])):D("",!0),s.value==="detail"?(w(),B(de,{key:2,"current-row":_.value},null,8,["current-row"])):D("",!0),s.value==="change"||s.value==="enabled"||s.value==="locked"?(w(),B(me,{key:3,ref_key:"writeRef",ref:$,"current-row":_.value,"action-type":s.value},null,8,["current-row","action-type"])):D("",!0)]),_:1},8,["modelValue","title"])]))}});export{gt as default};
