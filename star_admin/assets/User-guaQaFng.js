var ge=Object.defineProperty,ve=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var W=(c,r,o)=>r in c?ge(c,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[r]=o,X=(c,r)=>{for(var o in r||(r={}))_e.call(r,o)&&W(c,o,r[o]);if(Q)for(var o of Q(r))ke.call(r,o)&&W(c,o,r[o]);return c},Y=(c,r)=>ve(c,be(r));var b=(c,r,o)=>new Promise((z,P)=>{var S=p=>{try{h(o.next(p))}catch(C){P(C)}},V=p=>{try{h(o.throw(p))}catch(C){P(C)}},h=p=>p.done?z(p.value):Promise.resolve(p.value).then(S,V);h((o=o.apply(c,r)).next())});import{_ as we}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import{h as d,I as w,c as ye}from"./index-YGSL2gxf.js";import{_ as he}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";/* empty css               *//* empty css                   */import{b as Z,c as Ce,e as xe,f as Re}from"./index-CwH0tCVw.js";import{u as Ee}from"./useTable-YuVhaX40.js";import{_ as ze}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as Pe}from"./Write.vue_vue_type_script_setup_true_lang-DUIt294x.js";import{_ as Se}from"./Detail.vue_vue_type_script_setup_true_lang-DhH2AWpm.js";import{_ as Ae}from"./ChangePassword.vue_vue_type_script_setup_true_lang-Dd8gwCE-.js";import{_ as Be}from"./Dialog.vue_vue_type_style_index_0_lang-DNc9B0lB.js";import{g as De}from"./index-BTBuQ87_.js";import{v as Te,r as i,V as ee,M as l,H as m,w as $e,u as n,x as E,y as Ie,K as _,B as Ue,a3 as T,P as $,k as te,J as I,G as U,aH as Ve,n as Le}from"./vue-chunks-COp0tDkU.js";import{n as ae,a3 as y,k as Me,b as f}from"./element-plus-B2PLgZHf.js";/* empty css                *//* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IconPicker-Bnk7u0qr.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";import"./useValidator-DY0gbKVw.js";import"./Descriptions-CGScbuMD.js";/* empty css                  */const Ne={class:"flex w-100% h-100%"},Oe={class:"mb-10px"},$t=Te({__name:"User",setup(c){const r=i(null),{t:o}=ye(),z=i({}),{tableRegister:P,tableState:S,tableMethods:V}=Ee({fetchDataApi:()=>b(this,null,function*(){const{pageSize:e,currentPage:t}=S;let a={};return x.value&&x.value.id?a=yield Ce(x.value.id):(a=yield xe(n(t),n(e)),a.data.list.forEach(s=>{z.value[s.account]=s.id})),{list:a.data.list||[],total:a.data.total||0}}),fetchDelApi:()=>b(this,null,function*(){return!!(yield Re(n(M)))})}),{total:h,loading:p,dataList:C,pageSize:A,currentPage:B}=S,{getList:D,getElTableExpose:le,delList:oe}=V,ne=i([]),H=(e,t)=>e===0?t==="locked"?"冻结":"启用":t==="locked"?"解冻":"禁用",se=ee([{field:"selection",type:"selection"},{field:"account",label:"账号",slots:{default:e=>l(m,null,[e.row.account])}},{field:"nick",label:"昵称"},{field:"failed_attempts",label:"密码错误次数",slots:{default:e=>l(m,null,[e.row.failed_attempts])}},{field:"last_attempt_time",label:"密码最后一次错误时间",slots:{default:e=>l(m,null,[e.row.last_attempt_time])}},{field:"locked",label:"是否冻结",slots:{default:e=>l(m,null,[l(ae,{type:e.row.locked?"danger":"success"},{default:()=>[e.row.locked?"冻结":"正常"]})])}},{field:"lock_until",label:"冻结时间至",slots:{default:e=>l(m,null,[e.row.lock_until])}},{field:"enable",label:"是否启用",slots:{default:e=>l(m,null,[l(ae,{type:e.row.enable?"success":"danger"},{default:()=>[e.row.enable?"启用":"禁用"]})])}},{field:"ip",label:"登录IP"},{field:"ip_city",label:"IP所在城市",slots:{default:e=>l(m,null,[e.row.ip_city])}},{field:"role_name",label:"角色",slots:{default:e=>l(m,null,[e.row.role_name])}},{field:"desc",label:"说明",slots:{default:e=>l(m,null,[e.row.desc])}},{field:"action",label:"操作",width:340,slots:{default:e=>{const t=e.row;return l(m,null,[l(y,{content:"详情",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>N(t,"detail")},{default:()=>[l(w,{icon:"vi-bx:detail"},null)]})]}),l(y,{content:"修改密码",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>N(t,"change")},{default:()=>[l(w,{icon:"vi-material-symbols:passkey-rounded"},null)]})]}),l(y,{content:H(t.locked,"locked"),placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>q(t,"locked")},{default:()=>[l(w,{icon:"vi-game-icons:frozen-orb"},null)]})]}),l(y,{content:H(t.enable,"enabled"),placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>q(t,"enabled")},{default:()=>[l(w,{icon:"vi-material-symbols:person-add-disabled-outline-rounded"},null)]})]}),l(y,{content:"编辑",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>N(t,"edit")},{default:()=>[l(w,{icon:"vi-mingcute:edit-line"},null)]})]}),l(y,{content:"删除",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>K(t)},{default:()=>[l(w,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),re=ee([{field:"account",label:o("userDemo.account"),component:"Input"}]),x=i({}),j=e=>{e&&e.account?x.value={id:z.value[e.account]}:x.value=e,D()},ie=i(),G=Ve(),ce=()=>b(this,null,function*(){var e,t;try{const a=yield De();ne.value=(t=(e=a.data)==null?void 0:e.list)==null?void 0:t.map(s=>({label:s.role,value:s.id})),yield Le()}catch(a){console.error("Error fetching role options:",a)}}),J=i("");(()=>{J.value=G.path})(),$e(()=>G.path,e=>{e===J.value&&(ce(),D())});const k=i(!1),g=i(""),R=i(),u=i(""),ue=()=>{g.value=o("exampleDemo.add"),R.value=void 0,k.value=!0,u.value="add"},L=i(!1),M=i([]),K=e=>b(this,null,function*(){const t=yield le();M.value=e?[e.id]:(t==null?void 0:t.getSelectionRows().map(a=>a.id))||[],L.value=!0,yield oe(n(M).length).finally(()=>{L.value=!1})}),N=(e,t)=>{var a;switch(t){case"edit":g.value="编辑";break;case"detail":g.value="用户详情";break;case"change":g.value="修改密码";break;case"locked":g.value="修改冻结状态";break;case"enabled":g.value="修改账户状态";break}u.value=t,R.value=Y(X({},e),{department:((a=n(ie))==null?void 0:a.getCurrentNode())||{}}),k.value=!0},q=(e,t)=>{let a="是否冻结用户";e.locked===1&&(a="是否解冻用户"),t==="enabled"&&(e.enable===0?a="是否启用账户":a="是否禁用账户"),Me.confirm(a,"提示",{confirmButtonText:o("common.delOk"),cancelButtonText:o("common.delCancel"),type:"warning",center:!1}).then(()=>{const s=Object.assign({},e);t==="locked"?s.locked=s.locked===0?1:0:s.enable=s.enable===0?1:0,de(s)}).catch(()=>{f({type:"info",message:"取消修改状态"})})},de=e=>b(this,null,function*(){var t;try{f({message:"正在更新状态...",type:"info",duration:0});const a=yield Z(e);if((a==null?void 0:a.code)===200)f.closeAll(),f.success("状态更新成功"),yield D();else throw new Error(((t=a==null?void 0:a.data)==null?void 0:t.message)||"更新状态失败")}catch(a){console.error("更新状态失败:",a),f.error(a.message||"更新状态失败")}}),O=i(),F=i(!1),me=()=>b(this,null,function*(){var t,a;const e=n(O);try{const s=yield e==null?void 0:e.submit();if(!s)return;F.value=!0,s.role_id=s.role_name,f({message:"正在保存...",type:"info",duration:0});const v=yield Z(s);if((v==null?void 0:v.code)===200)f.closeAll(),f.success("操作成功"),k.value=!1,yield D(),s.id===((t=r.value)==null?void 0:t.id)&&window.location.reload();else throw new Error(((a=v==null?void 0:v.data)==null?void 0:a.message)||"操作失败")}catch(s){console.error("操作失败:",s),f.error(s.message||"操作失败")}finally{F.value=!1}}),pe=e=>{B.value=e},fe=e=>{A.value=e};return(e,t)=>(E(),Ie("div",Ne,[l(n(we),{class:"flex-[3] ml-20px"},{default:_(()=>[l(n(ze),{schema:re,onReset:j,onSearch:j},null,8,["schema"]),Ue("div",Oe,[l(n(d),{type:"primary",onClick:ue},{default:_(()=>[T($(n(o)("exampleDemo.add")),1)]),_:1}),l(n(d),{loading:L.value,type:"danger",onClick:t[0]||(t[0]=a=>K())},{default:_(()=>[T($(n(o)("exampleDemo.del")),1)]),_:1},8,["loading"])]),l(n(he),{"current-page":n(B),"onUpdate:currentPage":[t[1]||(t[1]=a=>te(B)?B.value=a:null),pe],"page-size":n(A),"onUpdate:pageSize":[t[2]||(t[2]=a=>te(A)?A.value=a:null),fe],columns:se,data:n(C),loading:n(p),onRegister:n(P),pagination:{total:n(h)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])]),_:1}),l(n(Be),{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=a=>k.value=a),title:g.value},{footer:_(()=>[u.value!=="detail"?(E(),I(n(d),{key:0,type:"primary",loading:F.value,onClick:me},{default:_(()=>[T($(n(o)("exampleDemo.save")),1)]),_:1},8,["loading"])):U("",!0),l(n(d),{onClick:t[3]||(t[3]=a=>k.value=!1)},{default:_(()=>[T($(n(o)("dialogDemo.close")),1)]),_:1})]),default:_(()=>[u.value==="edit"||u.value==="add"?(E(),I(Pe,{key:0,ref_key:"writeRef",ref:O,"current-row":R.value},null,8,["current-row"])):U("",!0),u.value==="detail"?(E(),I(Se,{key:1,"current-row":R.value},null,8,["current-row"])):U("",!0),u.value==="change"||u.value==="enabled"||u.value==="locked"?(E(),I(Ae,{key:2,ref_key:"writeRef",ref:O,"current-row":R.value,"action-type":u.value},null,8,["current-row","action-type"])):U("",!0)]),_:1},8,["modelValue","title"])]))}});export{$t as default};
