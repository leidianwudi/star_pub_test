var ne=Object.defineProperty;var N=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var O=(r,s,n)=>s in r?ne(r,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[s]=n,F=(r,s)=>{for(var n in s||(s={}))se.call(s,n)&&O(r,n,s[n]);if(N)for(var n of N(s))ie.call(s,n)&&O(r,n,s[n]);return r};var f=(r,s,n)=>new Promise((w,g)=>{var C=u=>{try{v(n.next(u))}catch(y){g(y)}},k=u=>{try{v(n.throw(u))}catch(y){g(y)}},v=u=>u.done?w(u.value):Promise.resolve(u.value).then(C,k);v((n=n.apply(r,s)).next())});import{u as re}from"./useTable-YuVhaX40.js";import{_ as me}from"./Table.vue_vue_type_script_lang-DscfV0RP.js";import{_ as ue}from"./Search.vue_vue_type_script_setup_true_lang-Yr7An4L0.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-QawWAx3l.js";import{h as d,I as V,_ as de}from"./index-YGSL2gxf.js";/* empty css                   *//* empty css               */import{_ as pe}from"./Write.vue_vue_type_script_setup_true_lang-BFJeZGrT.js";import{_ as fe}from"./Dialog.vue_vue_type_style_index_0_lang-DNc9B0lB.js";import{a as ge,b as ve,c as U}from"./index-BU1Y4vql.js";import{n as ye,a3 as $,k as _e,b as c}from"./element-plus-B2PLgZHf.js";import{v as be,V as j,r as m,u as o,j as we,M as l,H as b,x as L,y as ke,K as p,B as Se,a3 as B,k as H,J,P as K,G as q}from"./vue-chunks-COp0tDkU.js";/* empty css                    *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import"./el-radio-button-Bvrkr5tE.js";/* empty css                         *//* empty css                  */import"./index-A9CPyHPp.js";import"./Form-BurHqMWS.js";/* empty css                     *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                *//* empty css                    */import"./InputPassword-C3UAhF1U.js";import"./style.css_vue_type_style_index_0_src_true_lang-Bl0IfL3J.js";import"./wang-editor-FTv6NaqD.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-D7iXgQwo.js";import"./IconPicker-Bnk7u0qr.js";import"./IAgree.vue_vue_type_script_setup_true_lang-AinzJ7sY.js";import"./Highlight.vue_vue_type_script_lang-DIkvOg1B.js";import"./useForm-dGPra2nm.js";import"./useIcon-BkUmXMGL.js";import"./index-DOJE_sUj.js";/* empty css                  */const xe={class:"mb-10px"},Be=be({__name:"index",setup(r){const s=j([{field:"game_type_code",label:"游戏类型",component:"Input"},{field:"game_name",label:"游戏名称",component:"Input"}]),n=m({}),w=a=>{n.value=a,E()},g=m({}),{tableRegister:C,tableState:k,tableMethods:v}=re({fetchDataApi:()=>f(this,null,function*(){const{currentPage:a,pageSize:e}=k,t=F({page:o(a),pageSize:o(e)},o(n));t.game_name&&(t.game_code=g.value[t.game_name]);const i=yield ge(t);return i.data.list.forEach(G=>{g.value[G.gameBase.name]=G.game_code}),{list:i.data.list||[],total:i.data.total||0}}),fetchDelApi:()=>f(this,null,function*(){return!!(yield ve(o(R)))})}),{dataList:u,loading:y,total:Q,currentPage:S,pageSize:x}=k,{getList:E,getElTableExpose:W,delList:X}=v;we(()=>{});const Y=j([{field:"selection",type:"selection"},{field:"game_type_code",label:"游戏类型编号"},{field:"type_name",label:"类型名称",slots:{default:a=>l(b,null,[a.row.gameType.type_name])}},{field:"game_code",label:"游戏编号"},{field:"game_name",label:"游戏名称",slots:{default:a=>l(b,null,[a.row.gameBase.name])}},{field:"sort",label:"排序"},{field:"odds_key",label:"概率key"},{field:"odds_value",label:"概率值"},{field:"enable",label:"是否起效",slots:{default:a=>l(b,null,[l(ye,{type:a.row.enable?"success":"danger"},{default:()=>[a.row.enable?"开启":"关闭"]})])}},{field:"desc",label:"说明"},{field:"action",label:"操作",width:180,slots:{default:a=>{const e=a.row;return l(b,null,[l($,{content:"编辑",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>M(e,"edit")},{default:()=>[l(V,{icon:"vi-mingcute:edit-line"},null)]})]}),l($,{content:Z(e.enable),placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>ee(e)},{default:()=>[l(V,{icon:"vi-ep:open"},null)]})]}),l($,{content:"删除",placement:"top"},{default:()=>[l(d,{size:"small",onClick:()=>I(e)},{default:()=>[l(V,{icon:"vi-mingcute:delete-2-line"},null)]})]})])}}}]),Z=a=>a===0?"开启":"关闭",ee=a=>{let e="是否关闭概率";a.enable===0&&(e="是否开启概率"),_e.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!1}).then(()=>{const t=Object.assign({},a);t.enable=t.enable===0?1:0,te(t)}).catch(()=>{c({type:"info",message:"取消修改状态"})})},te=a=>f(this,null,function*(){var e;try{c({message:"正在更新状态...",type:"info",duration:0});const t=yield U(a);if((t==null?void 0:t.code)===200)c.closeAll(),c.success("状态更新成功"),yield E();else throw new Error(((e=t==null?void 0:t.data)==null?void 0:e.message)||"更新状态失败")}catch(t){console.error("更新状态失败:",t),c.error(t.message||"更新状态失败")}}),_=m(!1),h=m(""),A=m(),T=m(""),M=(a,e)=>{h.value="编辑",T.value=e,A.value=a,_.value=!0},D=m(),z=m(!1),ae=()=>f(this,null,function*(){var e;const a=o(D);try{const t=yield a==null?void 0:a.submit();if(!t)return;z.value=!0,t.gameType&&(t.gameType=null),t.gameBase&&(t.gameBase=null),c({message:"正在保存...",type:"info",duration:0});const i=yield U(t);if((i==null?void 0:i.code)===200)c.closeAll(),c.success("操作成功"),_.value=!1,yield E();else throw new Error(((e=i==null?void 0:i.data)==null?void 0:e.message)||"操作失败")}catch(t){console.error("操作失败:",t),c.error(t.message||"操作失败")}finally{z.value=!1}}),P=m(!1),R=m([]),I=a=>f(this,null,function*(){const e=yield W();R.value=a?[a.id]:(e==null?void 0:e.getSelectionRows().map(t=>t.id))||[],P.value=!0,yield X(o(R).length).finally(()=>{P.value=!1})}),le=a=>{S.value=a},oe=a=>{x.value=a};return(a,e)=>(L(),ke(b,null,[l(o(ce),null,{default:p(()=>[l(o(ue),{schema:s,onReset:w,onSearch:w},null,8,["schema"]),Se("div",xe,[l(o(d),{type:"primary",onClick:e[0]||(e[0]=t=>M({},"edit"))},{default:p(()=>e[6]||(e[6]=[B("新增")])),_:1}),l(o(d),{loading:P.value,type:"danger",onClick:e[1]||(e[1]=t=>I())},{default:p(()=>e[7]||(e[7]=[B(" 删除 ")])),_:1},8,["loading"])]),l(o(me),{pageSize:o(x),"onUpdate:pageSize":[e[2]||(e[2]=t=>H(x)?x.value=t:null),oe],currentPage:o(S),"onUpdate:currentPage":[e[3]||(e[3]=t=>H(S)?S.value=t:null),le],pagination:{total:o(Q)},columns:Y,data:o(u),loading:o(y),onRegister:o(C)},null,8,["pageSize","currentPage","pagination","columns","data","loading","onRegister"])]),_:1}),l(o(fe),{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:h.value},{footer:p(()=>[T.value!=="detail"?(L(),J(o(d),{key:0,type:"primary",loading:z.value,onClick:ae},{default:p(()=>e[8]||(e[8]=[B(K("保存"))])),_:1},8,["loading"])):q("",!0),l(o(d),{onClick:e[4]||(e[4]=t=>_.value=!1)},{default:p(()=>e[9]||(e[9]=[B(K("关闭"))])),_:1})]),default:p(()=>[T.value==="edit"?(L(),J(pe,{key:0,ref_key:"writeRef",ref:D,"current-row":A.value},null,8,["current-row"])):q("",!0)]),_:1},8,["modelValue","title"])],64))}}),dt=de(Be,[["__scopeId","data-v-fe7632e0"]]);export{dt as default};
